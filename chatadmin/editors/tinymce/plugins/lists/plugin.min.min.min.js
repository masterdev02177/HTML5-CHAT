tinymce.PluginManager.add("lists",function(b){var a=this;b.on("init",function(){function A(d){function c(h){var g,l,m;l=d[h?"startContainer":"endContainer"],m=d[h?"startOffset":"endOffset"],1==l.nodeType&&(g=e.create("span",{"data-mce-type":"bookmark"}),l.hasChildNodes()?(m=Math.min(m,l.childNodes.length-1),l.insertBefore(g,l.childNodes[m])):l.appendChild(g),l=g,m=0),f[h?"startContainer":"endContainer"]=l,f[h?"startOffset":"endOffset"]=m}var f={};return c(!0),c(),f}function E(d){function c(h){function p(o){for(var i=o.parentNode.firstChild,r=0;i;){if(i==o){return r}(1!=i.nodeType||"bookmark"!=i.getAttribute("data-mce-type"))&&r++,i=i.nextSibling}return-1}var g,l,m;g=m=d[h?"startContainer":"endContainer"],l=d[h?"startOffset":"endOffset"],1==g.nodeType&&(h?(l=p(g),g=g.parentNode):(l=p(g),g=g.parentNode),e.remove(m)),d[h?"startContainer":"endContainer"]=g,d[h?"startOffset":"endOffset"]=l}c(!0),c();var f=e.createRng();f.setStart(d.startContainer,d.startOffset),f.setEnd(d.endContainer,d.endOffset),t.setRng(f)}function w(c){return c&&/^(OL|UL)$/.test(c.nodeName)}function z(c){return c.parentNode.firstChild==c}function L(c){return c.parentNode.lastChild==c}function D(c){return c&&!!b.schema.getTextBlockElements()[c.nodeName]}function q(d,g){var c,f;if(b.settings.forced_root_block&&(g=g||b.settings.forced_root_block),f=g?e.create(g):e.createFragment(),d){for(;c=d.firstChild;){f.appendChild(c)}}return b.settings.forced_root_block||f.appendChild(e.create("br")),f.hasChildNodes()||tinymce.isIE||(f.innerHTML='<br data-mce-bogus="1">'),f}function I(){return tinymce.grep(t.getSelectedBlocks(),function(c){return"LI"==c.nodeName})}function J(){return tinymce.grep(t.getSelectedBlocks(),D)}function k(g,d,h){var c,f;h=h||q(d),c=e.createRng(),c.setStartAfter(d),c.setEndAfter(g),f=c.extractContents(),e.isEmpty(f)||e.insertAfter(f,g),e.isEmpty(h)||e.insertAfter(h,g),e.isEmpty(d.parentNode)&&e.remove(d.parentNode),e.remove(d)}function B(d){var c,f;if(c=d.nextSibling,c&&w(c)&&c.nodeName==d.nodeName){for(;f=c.firstChild;){d.appendChild(f)}e.remove(c)}if(c=d.previousSibling,c&&w(c)&&c.nodeName==d.nodeName){for(;f=c.firstChild;){d.insertBefore(f,d.firstChild)}e.remove(c)}}function H(c){tinymce.each(tinymce.grep(e.select("ol,ul",c)),function(f){var d,g=f.parentNode;"LI"==g.nodeName&&g.firstChild==f&&(d=g.previousSibling,d&&"LI"==d.nodeName&&(d.appendChild(f),e.isEmpty(g)&&e.remove(g))),w(g)&&(d=g.previousSibling,d&&"LI"==d.nodeName&&d.appendChild(f))})}function F(){var d,c=A(t.getRng(!0));return tinymce.each(I(),function(g){var h,f;return h=g.previousSibling,h&&"UL"==h.nodeName?(h.appendChild(g),void 0):h&&"LI"==h.nodeName&&w(h.lastChild)?(h.lastChild.appendChild(g),void 0):(h=g.nextSibling,h&&"UL"==h.nodeName?(h.insertBefore(g,h.firstChild),void 0):(h&&"LI"==h.nodeName&&w(g.lastChild)||(h=g.previousSibling,h&&"LI"==h.nodeName&&(f=e.create(g.parentNode.nodeName),h.appendChild(f),f.appendChild(g)),d=!0),void 0))}),E(c),d}function x(){function f(g){e.isEmpty(g)&&e.remove(g)}var d,c=A(t.getRng(!0));return tinymce.each(I(),function(o){var h,g=o.parentNode,m=g.parentNode;if(z(o)&&L(o)){if("LI"==m.nodeName){e.insertAfter(o,m),f(m)}else{if(!w(m)){return}e.remove(g,!0)}}else{if(z(o)){if("LI"==m.nodeName){e.insertAfter(o,m),h=e.create("LI"),h.appendChild(g),e.insertAfter(h,o),f(m)}else{if(!w(m)){return}m.insertBefore(o,g)}}else{if(L(o)){if("LI"==m.nodeName){e.insertAfter(o,m)}else{if(!w(m)){return}e.insertAfter(o,g)}}else{if("LI"==m.nodeName){g=m,h=q(o,"LI")}else{if(!w(m)){return}h=q(o,"LI")}k(g,o,h),H(g.parentNode)}}}d=!0}),E(c),d}function G(f){function i(){function l(s){var C,o,y=b.getBody();for(C=c[s?"startContainer":"endContainer"],o=c[s?"startOffset":"endOffset"],1==C.nodeType&&(C=C.childNodes[Math.min(o,C.childNodes.length-1)]||C);C.parentNode!=y;){if(D(C)){return C}if(/^(TD|TH)$/.test(C.parentNode.nodeName)){return C}C=C.parentNode}return C}function v(s,r){var y,o=[];if(!D(s)){for(;s&&(y=s[r?"previousSibling":"nextSibling"],!e.isBlock(y)&&y);){s=y}for(;s;){o.push(s),s=s[r?"nextSibling":"previousSibling"]}}return o}var d,p,u=l(!0),m=l();p=v(u,!0),u!=m&&(p=p.concat(v(m).reverse())),tinymce.each(p,function(n){if(!e.isBlock(n)||"BR"==n.nodeName){if(!d||"BR"==n.nodeName){if("BR"==n.nodeName&&(!n.nextSibling||e.isBlock(n.nextSibling)&&"BR"!=n.nextSibling.nodeName)){return e.remove(n),!1}d=e.create("p"),h.push(d),n.parentNode.insertBefore(d,n)}return"BR"!=n.nodeName?d.appendChild(n):e.remove(n),n==m?!1:void 0}})}var c=t.getRng(!0),g=A(c),h=J();i(),tinymce.each(h,function(l){var m,d;d=l.previousSibling,d&&w(d)&&d.nodeName==f?(m=d,l=e.rename(l,"LI"),d.appendChild(l)):(m=e.create(f),l.parentNode.insertBefore(m,l),m.appendChild(l),l=e.rename(l,"LI")),B(m)}),E(g)}function j(){var c=A(t.getRng(!0));tinymce.each(I(),function(f){var d,g;for(d=f;d;d=d.parentNode){w(d)&&(g=d)}k(g,f)}),E(c)}function K(f){var c=e.getParent(t.getStart(),"OL,UL");if(c){if(c.nodeName==f){j(f)}else{var d=A(t.getRng(!0));B(e.rename(c,f)),E(d)}}else{G(f)}}var e=b.dom,t=b.selection;a.backspaceDelete=function(i){function g(p,l){var s=p.startContainer,d=p.startOffset;if(3==s.nodeType&&(l?d<s.data.length:d>0)){return s}for(var o=new tinymce.dom.TreeWalker(p.startContainer);s=o[l?"next":"prev"]();){if(3==s.nodeType&&s.data.length>0){return s}}}function n(p,l){var s,d,r=p.parentNode;for(w(l.lastChild)&&(d=l.lastChild),s=l.lastChild,s&&"BR"==s.nodeName&&p.hasChildNodes()&&e.remove(s);s=p.firstChild;){l.appendChild(s)}d&&l.appendChild(d),e.remove(p),e.isEmpty(r)&&e.remove(r)}if(t.isCollapsed()){var f=e.getParent(t.getStart(),"LI");if(f){var c=t.getRng(!0),h=e.getParent(g(c,i),"LI");if(h&&h!=f){var m=A(c);return i?n(h,f):n(f,h),E(m),!0}if(!h&&!i&&j(f.parentNode.nodeName)){return!0}}}},b.addCommand("Indent",function(){return F()?void 0:!0}),b.addCommand("Outdent",function(){return x()?void 0:!0}),b.addCommand("InsertUnorderedList",function(){K("UL")}),b.addCommand("InsertOrderedList",function(){K("OL")})}),b.on("keydown",function(c){c.keyCode==tinymce.util.VK.BACKSPACE?a.backspaceDelete()&&c.preventDefault():c.keyCode==tinymce.util.VK.DELETE&&a.backspaceDelete(!0)&&c.preventDefault()})});