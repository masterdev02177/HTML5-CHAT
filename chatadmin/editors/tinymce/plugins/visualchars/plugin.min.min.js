tinymce.PluginManager.add("visualchars",function(c){function b(m){var g,j,f,i,p,e,h=c.getBody(),k=c.selection;if(a=!a,c.fire("VisualChars",{state:a}),m&&(e=k.getBookmark()),a){for(j=[],tinymce.walk(h,function(l){3==l.nodeType&&l.nodeValue&&-1!=l.nodeValue.indexOf("Â ")&&j.push(l)},"childNodes"),f=0;f<j.length;f++){for(i=j[f].nodeValue,i=i.replace(/(\u00a0)/g,'<span data-mce-bogus="1" class="mce-nbsp">$1</span>'),p=c.dom.create("div",null,i);g=p.lastChild;){c.dom.insertAfter(g,j[f])}c.dom.remove(j[f])}}else{for(j=c.dom.select("span.mce-nbsp",h),f=j.length-1;f>=0;f--){c.dom.remove(j[f],1)}}k.moveToBookmark(e)}function d(){var e=this;c.on("VisualChars",function(f){e.active(f.state)})}var a;c.addCommand("mceVisualChars",b),c.addButton("visualchars",{title:"Show invisible characters",cmd:"mceVisualChars",onPostRender:d}),c.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:d,selectable:!0,context:"view",prependToContext:!0}),c.on("beforegetcontent",function(f){a&&"raw"!=f.format&&!f.draft&&(a=!0,b(!1))})});